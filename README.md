# System Design социальной сети для [курса](https://balun.courses/courses/system_design)

## Специальная социальная сеть для путешественников

### Функциональные требования

Необходимо, чтобы в сервисе можно было

- публиковать посты из путешествий с фотографиями (до 10 фото на пост), небольшим описанием (до 256 символов) и привязкой к конкретному месту путешествия
- оценивать (лайки) и комментировать (также до 256 символов) посты других путешественников
- подписываться на других путешественников, чтобы следить за их активностью
- искать популярные места для путешествий и просматривать посты с этих мест
- просматривать ленты других путешественников и свою ленту, основанные на подписках в обратном хронологическом порядке

### Нефункциональные требования

- Количество пользователей: 10 000 000 DAU и более через год
- Доступность 99.95%
- Поддержка СНГ региона
- Все данные хранятся вечно
- Без сезонности

- Исходя из личного опыта, в среднем:
  - пользователь:
    - просматривает 10 страниц по 20 постов за одну сессию
    - проводит 3 сессии в день
    - загружает пост раз в 2 дня
    - имеет 50 подписок
    - комментирует каждый 100ый пост (оставляет 2 комментария за сессию)
  - пост имеет:
    - 3 фото
    - 5 комментариев

### Подсчет нагрузки

#### RPS:

- write:
  - посты: 10 000 000 dau \* 3 \* 1/2 / 86400 = 174
  - комментарии: 10 000 000 dau \* 3 \* 2 / 86400 = 696
- read:
  - лента: 10 000 000 dau \* 3 \* 10 / 86400 = 3 500

#### Traffic

- Основные сущности

  - Пост:
    - id (u64)
    - author_id (u64)
    - description (utf8[256])
    - created_at (timestamptz)
    - photos (ограничим в 8mb)
    - lat (f32)
    - lon (f32)
    - comments:
      - id (u64)
      - text (utf8[256])
      - author_id (u64)
  - Коммент:
    - id (u64)
    - text (utf8[256])
    - post_id (u64)
    - author_id (u64)

- Write:
  - Посты: 174 r/s \* (8 + 8 + 256 \* 4 + 8 + 3 \* 8 000 000 (max photo size) + 4 + 4 + 5 \* (8 + 256 \* 4 + 8)) b/r = 1400 gb/s
  - Комменты: 696 r/s \* (8 + 256 \* 4 + 8 + 8) b/r = 729 kb/s
- Read:
  - 3 500 r/s \* (20 \* (8 + 8 + 256 \* 4 + 8 + 3 \* 8 000 000 (max photo size) + 4 + 4 + 5 \* (8 + 256 \* 4 + 8))) b/r = 30 tb/s

#### Disk space

- В год потребуется:
  - Верхняя оценка: 174 \* 60 \* 60 \* 24 \* 365 \* 3 \* 8 mb = 131 694 336 000 mb < 150 pb
  - Средняя оценка: < 100 pb
