# System Design социальной сети для [курса](https://balun.courses/courses/system_design)

## Специальная социальная сеть для путешественников

### Функциональные требования

Необходимо, чтобы в сервисе можно было

- публиковать посты из путешествий с фотографиями (до 10 фото на пост), небольшим описанием (до 256 символов) и привязкой к конкретному месту путешествия
- оценивать (лайки) и комментировать (также до 256 символов) посты других путешественников
- подписываться на других путешественников, чтобы следить за их активностью
- искать популярные места для путешествий и просматривать посты с этих мест
- просматривать ленты других путешественников и свою ленту, основанные на подписках в обратном хронологическом порядке

### Нефункциональные требования

- Количество пользователей: 10 000 000 DAU и более через год
- Доступность 99.95%
- Поддержка только СНГ региона
- Все данные хранятся вечно
- Сезонность связяна с праздниками и периодами отпусков
- Ограничения:
  - не более 10 фото в посте
  - не более 1000 подписок у пользоаптеля
  - не более 256 символов в посте/комментарии
  - фото не более 8 МБ
- Временные ограничения:

  - Отдавать страницы выдачи ленты за секунду
  - Отдавать страницы выдачи поиска по гео за 2 секунды
  - Создавать пост за секунду
  - Подписки/лайки моментальны (100 мс)
  - Комментарии за 500 мс

- Исходя из личного опыта, в среднем:
  - пользователь:
    - просматривает 10 страниц по 20 постов за одну сессию (время межку заходом и выходом из приложения)
    - проводит 3 сессии в день
    - загружает пост раз в 2 дня
    - имеет 50 подписок
    - комментирует каждый 100ый пост (оставляет 2 комментария за сессию)
    - подписывается/отписывается раз в день
    - просматривает 5 страниц по 20 постов при помощи поиска по местоположению в день
  - пост имеет:
    - 3 фото
    - 5 комментариев

### Подсчет нагрузки

#### RPS:

- write:
  - посты: 10 000 000 dau \* 3 \* 1/2 / 86400 = 174
  - комментарии: 10 000 000 dau \* 3 \* 2 / 86400 = 696
  - подписки: 10 000 000 dau / 86400 = 116
- read:
  - лента: 10 000 000 dau \* 3 \* 10 / 86400 = 3 500
  - поиск по местоположению: 10 000 000 dau \* 5 / 86400 = 579

#### Traffic

- Основные сущности

  - Пост:
    - id (u64)
    - author_id (u64)
    - description (utf8[256])
    - created_at (timestamptz)
    - photos (ограничим в 8mb)
    - lat (f32)
    - lon (f32)
    - comments:
      - id (u64)
      - text (utf8[256])
      - author_id (u64)
  - Коммент:
    - id (u64)
    - text (utf8[256])
    - post_id (u64)
    - author_id (u64)
  - Подписка:
    - from_id (u64)
    - to_id (u64)

- Write:
  - Посты:
    - мета: 174 r/s \* (8 + 8 + 256 \* 4 + 8 + 3 \* 128 (photo urls) + 4 + 4 + 5 \* (8 + 256 \* 4 + 8)) b/r = 1 155 360 b/s ≈ 1 mb/s
    - медиа: 174 r/s \* 3 \* 8 mb/r = 4 176 mb ≈ 4 gb/s
  - Комменты: 696 r/s \* (8 + 256 \* 4 + 8 + 8) b/r = 729 408 b/s ≈ 730 kb/s
  - Подписки: 116 r/s \* (8 + 8) b/r = 1 856 b/s ≈ 2 kb/s
- Read:
  - Лента:
    - мета: 3 500 r/s \* (20 \* (8 + 8 + 256 \* 4 + 8 + 3 \* 128 (photo urls) + 4 + 4 + 5 \* (8 + 256 \* 4 + 8))) b/r = 449 400 000 b/s ≈ 500 mb/s
    - медиа: 3 500 r/s \* 20 \* 3 \* 8 mb/r = 1 680 000 mb/s ≈ 2 tb/s
  - Поиск по местоположению:
    - мета: 579 r/s \* (20 \* (8 + 8 + 256 \* 4 + 8 + 3 \* 128 (photo urls) + 4 + 4 + 5 \* (8 + 256 \* 4 + 8))) b/r = 74 343 600 b/s ≈ 75 mb/s
    - медиа: 579 r/s \* 20 \* 3 \* 8 mb/r = 277 920 mb/s ≈ 280 gb/s
